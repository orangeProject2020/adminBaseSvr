exports.ids=[5],exports.modules={89:function(t,e,o){"use strict";var n=o(8);e.a={getUserListData:async data=>await n.a.post("/api/user/data/list",data),getNoticeListData:async data=>await n.a.post("/api/user/notice/list",data),noticeDataCreate:async data=>await n.a.post("/api/user/notice/create",data),noticeDataUpdate:async data=>await n.a.post("/api/user/notice/update",data),noticeSendUser:async data=>await n.a.post("/api/user/notice/sendUser",data),noticeDelete:async data=>await n.a.post("/api/user/notice/delete",data),getMessageListData:async data=>await n.a.post("/api/user/message/list",data)}},91:function(t,e,o){"use strict";var n=o(87),r=o.n(n);e.a={formValidata:t=>new Promise((e,o)=>{t.validate(t=>{e(!!t)})}),unLimitTreeLevel(t,e=0){var o=[],n=function(t,e,r){for(var i=0;i<t.length;i++){var l=t[i];if(l.pid==e){l.level=r,l.html="";for(let t=0;t<r;t++)l.html+=" -- ";o.push(l),n(t,l.id,r+1)}}};return n(t,e,0),o},getTimestamp(t){let e=new Date(t);return parseInt(e.getTime()/1e3)},dateFormat(t,e){e=e||"YYYY-MM-DD HH:mm";let o=null;return o=t?new Date(1e3*t):new Date,r()(o).format(e)},dateDisplay(t){let e=parseInt(Date.now()/1e3)-t;if(e<60)return e+"秒前";if(e>=60&&e<3600)return parseInt(e/60).toString()+"分钟前";if(e>=3600&&e<86400)return parseInt(e/3600).toString()+"小时前";if(e>=86400&&e<2592e3)return parseInt(e/3600/24).toString()+"天前";{let e="YYYY-MM-DD HH:mm",o=new Date(1e3*t);return r()(o).format(e)}},monthPlus(t,e=1,o=!0){let n=[31,28,31,30,31,30,31,31,30,31,30,31],r=parseInt(this.dateFormat(t,"YYYY")),l=parseInt(this.dateFormat(t,"MM")),c=parseInt(this.dateFormat(t,"DD"));n[1]=r%4==0&&r/100!=0||r%100==0&&r%400==0?29:28;let d=0;d+=n[l-1]-c;for(let i=0;i<e;i++){(l+=1)>12&&(l=1,r+=1),n[1]=r%4==0&&r/100!=0||r%100==0&&r%400==0?29:28;let t=n[l-1];i==e-1&&(t=t-c<0?t:c),console.log("for days:",t),d+=t}return o?(t=t||parseInt(Date.now()/1e3))+24*d*3600:d}}},92:function(t,e,o){"use strict";var n={},r=o(2),component=Object(r.a)(n,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("el-menu",{attrs:{"default-active":this.$store.state.subNavMsgIndex,mode:"horizontal"}},[e("el-menu-item",{attrs:{index:"0"}},[e("router-link",{attrs:{to:"/msg/notice"}},[this._v("公告消息")])],1),this._v(" "),e("el-menu-item",{attrs:{index:"1"}},[e("router-link",{attrs:{to:"/msg/list"}},[this._v("用户消息记录")])],1)],1)],1)}),[],!1,null,null,"1bf15d84");e.a=component.exports},96:function(t,e,o){"use strict";o.r(e);var n=o(89),r=o(91),l={components:{SubNavMsg:o(92).a},head:()=>({title:"公告消息"}),data:()=>({listData:{list:[],page:1,limit:1,count:0,search:""},dialogNoticeUpdateVisible:!1,noticeInfoUpdateBtn:{disabled:!1},notice:{id:0,title:"",info:""},rulesNotice:{title:[{required:!0,message:"请输入公告名称",trigger:"blur"}],info:[{required:!0,message:"请输入公告内容",trigger:"blur"}]}}),methods:{...r.a,async getListData(){let data={};data.page=this.listData.page,data.limit=this.listData.limit,data.search=this.listData.search;try{let t=await n.a.getNoticeListData(data);if(console.log("/getListData dataRet:",t),0!==t.code)throw new Error(t.message);this.listData.count=t.data.count,t.data.rows.forEach(t=>{this.listData.list.push(t)})}catch(t){this.$message.error(t.message||"获取列表数据失败")}},getRefreshData(){this.listData.list=[],this.listData.count=0,this.getListData()},pageChange(t){this.listData.list=[],this.listData.page=t,this.getListData()},noticeAddBtnClick(){this.notice.id=0,this.notice.title="",this.notice.info="",this.dialogNoticeUpdateVisible=!0},noticeInfoUpdateBtnClick(t){this.notice.id=t.id,this.notice.title=t.title,this.notice.info=t.info,console.log("/noticeInfoUpdateBtnClick this.notice:",this.notice),this.dialogNoticeUpdateVisible=!0},async noticeInfoUpdate(){let t=await this.$refs.formNoticeUpdate.validate();if(console.log("/noticeInfoUpdate valid:",t),!0!==t)return;this.noticeInfoUpdateBtn.disabled=!0;let data=this.notice;console.log("/noticeInfoUpdate data:",data);try{let t;if(0!==(t=data.id?await n.a.noticeDataUpdate(data):await n.a.noticeDataCreate(data)).code)throw new Error(t.message);this.getRefreshData()}catch(t){this.$message.error(t.message||t)}this.noticeInfoUpdateBtn.disabled=!1,this.dialogNoticeUpdateVisible=!1},async noticeSendToUser(t){let data={id:t.id};try{let t=await this.$confirm("发送公告消息给所有用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});if(console.log("/noticeSendToUser confirm",t),"confirm"!==t)return}catch(t){return void console.error("/noticeSendToUser err:",t.message||t)}try{let t=await n.a.noticeSendUser(data);if(0!==t.code)throw new Error(t.message);this.getRefreshData(),this.$message("发送成功")}catch(t){this.$message.error(t.message||t)}},async noticeDelete(t){let data={id:t.id};try{let t=await this.$confirm("删除公告消息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});if(console.log("/noticeDelete confirm",t),"confirm"!==t)return}catch(t){return void console.error("/noticeDelete err:",t.message||t)}try{let t=await n.a.noticeDelete(data);if(0!==t.code)throw new Error(t.message);this.getRefreshData(),this.$message("删除成功")}catch(t){this.$message.error(t.message||t)}}},created(){this.getListData()}},c=o(2),component=Object(c.a)(l,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("sub-nav-msg"),t._ssrNode(" "),o("el-row",{staticClass:"mt-4"},[o("el-col",{attrs:{span:6}},[o("el-input",{attrs:{size:"mini",placeholder:"输入关键字搜索"},model:{value:t.listData.search,callback:function(e){t.$set(t.listData,"search",e)},expression:"listData.search"}})],1),t._v(" "),o("el-col",{staticClass:"text-right",attrs:{span:18}},[o("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.noticeAddBtnClick}},[t._v("添加")])],1)],1),t._ssrNode(" "),o("el-table",{attrs:{data:t.listData.list}},[o("el-table-column",{attrs:{label:"ID",prop:"id"}}),t._v(" "),o("el-table-column",{attrs:{label:"标题",prop:"title"}}),t._v(" "),o("el-table-column",{attrs:{label:"添加时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.dateFormat(e.row.create_time)))]}}])}),t._v(" "),o("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.status?o("span",[t._v("未发送")]):t._e(),t._v(" "),1==e.row.status?o("span",[t._v("已发送")]):t._e()]}}])}),t._v(" "),o("el-table-column",{attrs:{align:"right",fixed:"right",label:"操作",width:"300"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(o){return t.noticeSendToUser(e.row)}}},[t._v("发送给用户")]),t._v(" "),o("el-button",{attrs:{size:"mini",plain:""},on:{click:function(o){return t.noticeInfoUpdateBtnClick(e.row)}}},[t._v("查看 / 修改")]),t._v(" "),o("el-button",{attrs:{size:"mini",type:"danger",plain:""},on:{click:function(o){return t.noticeDelete(e.row)}}},[t._v("删除")])]}}])})],1),t._ssrNode(" "),o("el-pagination",{staticClass:"mt-4",attrs:{"current-page":t.listData.page,"page-size":t.listData.limit,layout:"prev, pager, next, total, jumper",total:t.listData.count},on:{"current-change":t.pageChange,"prev-click":t.pageChange,"next-click":t.pageChange}}),t._ssrNode(" "),o("el-dialog",{attrs:{title:"公告添加 / 修改",visible:t.dialogNoticeUpdateVisible},on:{"update:visible":function(e){t.dialogNoticeUpdateVisible=e}}},[o("el-form",{ref:"formNoticeUpdate",attrs:{model:t.notice,"label-width":"100px",rules:t.rulesNotice}},[o("el-form-item",{attrs:{label:"标题",prop:"title"}},[o("el-input",{model:{value:t.notice.title,callback:function(e){t.$set(t.notice,"title",e)},expression:"notice.title"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"内容",prop:"info"}},[o("el-input",{attrs:{type:"textarea",rows:5},model:{value:t.notice.info,callback:function(e){t.$set(t.notice,"info",e)},expression:"notice.info"}})],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.dialogNoticeUpdateVisible=!1}}},[t._v("取消")]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:t.noticeInfoUpdateBtn.disabled},on:{click:t.noticeInfoUpdate}},[t._v("确定")])],1)],1)],2)}),[],!1,null,null,"f4863bac");e.default=component.exports}};